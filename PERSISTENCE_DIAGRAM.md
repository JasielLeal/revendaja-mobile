/\*\*

- ğŸ’¾ PERSISTÃŠNCIA DE NOTIFICAÃ‡Ã•ES - O QUE MUDOU
-
- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
- â•‘ ANTES: Tudo em memÃ³ria (React State) â•‘
- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- App aberto
- â†“
- NotificaÃ§Ãµes em estado React
- â†“
- UsuÃ¡rio fecha o app
- â†“
- âŒ Todas as notificaÃ§Ãµes desaparecem!
-
-
- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
- â•‘ DEPOIS: Persistido em AsyncStorage â•‘
- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- App aberto
- â†“
- Carrega notificaÃ§Ãµes do AsyncStorage
- â†“
- NotificaÃ§Ãµes em estado React + AsyncStorage
- â†“
- UsuÃ¡rio recebe notificaÃ§Ã£o
- â†“
- Salva automaticamente no AsyncStorage
- â†“
- UsuÃ¡rio fecha o app
- â†“
- âœ… NotificaÃ§Ãµes permanecem no AsyncStorage!
- â†“
- UsuÃ¡rio abre novamente
- â†“
- âœ… Todas as notificaÃ§Ãµes reaparecem
-
-
- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
- â•‘ MUDANÃ‡AS NO CÃ“DIGO â•‘
- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- 1.  useNotifications.ts
-
- ANTES:
- const [notifications, setNotifications] = useState([]);
-
- DEPOIS:
- const [notifications, setNotifications] = useState([]);
- const [isLoading, setIsLoading] = useState(true);
-
- - useEffect(() => {
-        loadNotificationsFromStorage();
-      }, []);
-
- - async function loadNotificationsFromStorage() { ... }
- - async function saveNotificationsToStorage() { ... }
-
-
- 2.  Timestamp
-
- ANTES:
- timestamp: Date
-
- DEPOIS:
- timestamp: string (ISO format: "2025-12-10T14:32:00Z")
-
- Por quÃª? AsyncStorage sÃ³ armazena strings
-
-
- 3.  Cada aÃ§Ã£o agora chama saveNotificationsToStorage()
-
- markAsRead() â†’ saveNotificationsToStorage()
- deleteNotification() â†’ saveNotificationsToStorage()
- clearAll() â†’ saveNotificationsToStorage()
- addNotification() â†’ saveNotificationsToStorage()
-
-
- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
- â•‘ DIAGRAMA DE FLUXO â•‘
- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- ğŸ”„ CARREGAMENTO (Ao abrir app)
-
- App Start
- â†“
- useNotifications hook
- â†“
- loadNotificationsFromStorage()
- â†“
- AsyncStorage.getItem('notifications_list')
- â†“
- JSON.parse(saved)
- â†“
- setNotifications(parsed)
- â†“
- setIsLoading(false)
- â†“
- UI renderiza com histÃ³rico
-
-
- ğŸ’¾ SALVAMENTO (Ao receber notificaÃ§Ã£o)
-
- Socket event
- â†“
- Notifications.scheduleNotificationAsync()
- â†“
- useNotifications listener
- â†“
- addNotification()
- â†“
- saveNotificationsToStorage()
- â†“
- AsyncStorage.setItem('notifications_list', JSON.stringify(...))
- â†“
- âœ… Salvo permanentemente
-
-
- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
- â•‘ ESTADOS DA APLICAÃ‡ÃƒO â•‘
- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- MemÃ³ria (React State) AsyncStorage Resultado
- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- [] Vazio Sem notificaÃ§Ãµes
- [notif1, notif2] [notif1, notif2] âœ… Normal
- [] [notif1, notif2] Carregando (isLoading)
- [notif1, notif2] [notif1, notif2, notif3] Em sincronizaÃ§Ã£o
-
-
- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
- â•‘ CASOS DE USO â•‘
- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- âœ… CASO 1: UsuÃ¡rio vÃª notificaÃ§Ã£o e sai do app
-
- 1.  Recebe notificaÃ§Ã£o â†’ Salva em AsyncStorage
- 2.  Marca como lida â†’ Atualiza AsyncStorage
- 3.  Sai do app
- 4.  Abre 1 semana depois
- 5.  âœ… NotificaÃ§Ã£o ainda estÃ¡ lÃ¡
-
-
- âœ… CASO 2: UsuÃ¡rio quer limpar notificaÃ§Ãµes
-
- 1.  Clica X em uma notificaÃ§Ã£o
- 2.  deleteNotification() â†’ saveNotificationsToStorage([...])
- 3.  AsyncStorage atualizado
- 4.  Sai do app
- 5.  âœ… NotificaÃ§Ã£o nÃ£o reaparece
-
-
- âœ… CASO 3: Celular desliga
-
- 1.  App tem notificaÃ§Ãµes
- 2.  Todas salvas no AsyncStorage
- 3.  Celular desliga (forÃ§a)
- 4.  Celular liga novamente
- 5.  App abre
- 6.  âœ… loadNotificationsFromStorage() carrega tudo
-
-
- âœ… CASO 4: Usuario quer limpar tudo
-
- 1.  Clica botÃ£o de lixeira
- 2.  clearAll() â†’ saveNotificationsToStorage([])
- 3.  AsyncStorage limpo
- 4.  UI mostra "Sem notificaÃ§Ãµes"
- 5.  âœ… Permanentemente deletado
-
-
- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
- â•‘ DETALHES TÃ‰CNICOS â•‘
- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- AsyncStorage Key:
- "notifications_list"
-
- Formato Salvo:
- JSON string com array de notificaÃ§Ãµes
-
- Timestamp:
- ISO 8601 format: "2025-12-10T14:32:00.000Z"
- Convertido de Date.toISOString()
-
- Limite:
- ~10MB por app (bastante para centenas de notificaÃ§Ãµes)
-
- SincronizaÃ§Ã£o:
- SÃ­ncrona no saveNotificationsToStorage()
- AssÃ­ncrona (nÃ£o bloqueia UI)
-
-
- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
- â•‘ FLUXO DETALHADO â•‘
- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- [App Launch]
- â†“
- [useNotifications()] â†’ useEffect(() => loadNotificationsFromStorage(), [])
- â†“
- [AsyncStorage.getItem('notifications_list')]
- â†“
- [if saved] â†’ JSON.parse(saved)
- â†“
- [setNotifications(parsed)] â†’ UI re-renders com histÃ³rico
- [setIsLoading(false)]
- â†“
- [App Ready] â† NotificationsCenter pronta com dados antigos
-
-
- [Nova NotificaÃ§Ã£o Recebida]
- â†“
- [socket.ts] â†’ Notifications.scheduleNotificationAsync()
- â†“
- [useNotifications.addNotificationReceivedListener]
- â†“
- [addNotification(newNotif)]
- â†“
- [setNotifications([newNotif, ...prev])]
- â†“
- [saveNotificationsToStorage(updated)]
- â†“
- [AsyncStorage.setItem('notifications_list', JSON.stringify(updated))]
- â†“
- [UI re-renders] â† NotificaÃ§Ã£o aparece no modal
- [Permanentemente salva!]
-
-
- â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
- â•‘ SEGURANÃ‡A â•‘
- â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-
- âš ï¸ AsyncStorage NÃƒO Ã© criptografado
-
- ImplicaÃ§Ãµes:
- - Qualquer app com permissÃ£o pode ler
- - Qualquer um com acesso ao telefone pode ver
- - Dados nÃ£o devem ser sensÃ­veis (senhas, tokens, etc)
-
- Para este caso (notificaÃ§Ãµes de vendas):
- - âœ… Seguro o suficiente
- - Dados jÃ¡ sÃ£o vistos em SMS/push
- - Simples e rÃ¡pido
-
- Se precisar de maior seguranÃ§a:
- - React Native Keychain (para dados sensÃ­veis)
- - Expo SecureStore (criptografado)
- - Backend para sincronizar
    \*/
